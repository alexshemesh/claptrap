sudo: required
language: go
go:
- 1.8.3
- tip
before_install:
- GLIDE_OS_ARCH=`go env GOHOSTOS`-`go env GOHOSTARCH`
- GLIDE_TAG=$(curl -s https://glide.sh/version)
- GLIDE_LATEST_RELEASE_URL="https://github.com/Masterminds/glide/releases/download/${GLIDE_TAG}/glide-${GLIDE_TAG}-${GLIDE_OS_ARCH}.tar.gz"
- wget ${GLIDE_LATEST_RELEASE_URL} -O /tmp/glide.tar.gz
- mkdir /tmp/glide
- tar --directory=/tmp/glide -xvf /tmp/glide.tar.gz
- export PATH=$PATH:/tmp/glide/${GLIDE_OS_ARCH}
- sudo apt-get update -q
- sudo apt-get install upx -y
install: glide install
after_success:
- |-
  echo "After Success:"
  echo $TRAVIS_TAG
  echo $TRAVIS_GO_VERSION
  if [ "$TRAVIS_TAG" != "" ] && [ "$TRAVIS_GO_VERSION" == "1.8.3" ]
  then
    CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -ldflags="-s -w -X main.Version=$TRAVIS_TAG" -o build/claptrap-linux-amd64-$TRAVIS_TAG
    CGO_ENABLED=0 GOOS=darwin GOARCH=amd64 go build -ldflags="-s -w -X main.Version=$TRAVIS_TAG" -o build/claptrap-darwin-amd64-$TRAVIS_TAG
    CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build -ldflags="-s -w -X main.Version=$TRAVIS_TAG" -o build/claptrap-windows-amd64-$TRAVIS_TAGv
  fi
script: go test --cover $(go list ./... | grep -v '/vendor/')

deploy:
  provider: s3
  skip_cleanup: true
  access_key_id: AKIAIFXY43SCFTSOEXJA
  secret_access_key:
    secure: XIewh5mTsxigAunoVP8tcBI9tjHBAg16M+f26pG195kc3B9d6YwK/acB5GUtWlwFFR2U/lC0YisQNTOEbcvBKkeo46wysW8uY/hOcrTQUqIZTBVPvY/Ac3oCu8DJuTmAK5+8c7lJhayEul50FXsUQBfV9Yxwf6fn+l2WohC19l8KZOua7xEuBRiI6uYyhZ+InaOPebHXJCpawFA9KrQfepwA0EH5DTZIYMXc9n9juLdpe7N4khpiICcv7eXQ1qHf/vPvU3G7b3TXvHaO7jVmPXBSn6n0cleGDvab/gI/4xBIR6kB2j9DrrcgiSqulQ4dp+MVYBzKtpZ/0iw7MscRTYKaDReLZUXlpw6FHrU+Oq9apMLYRmwJ3/+2L+7MKvLLkjiuo1UWKNZayyxOlYI51x2nVWFICycRlupQ2VchONCmrU/th3FhMXDZfVW2c6Q4YRI3S+rA2+ghtcxym1kxR1/QcIgQ3mnlkt/KZ8M6DhrJM/TfUaCjoixSKnV9xtJDYIQ0dmaefODBforbm0gak/hyEHes2Ydmal/XcYyY1X+iwAAtNFKjy/LEoGmhG7W+oQOH0XE/u6ZQm6qU9+CmsHK0l4JIFxqVP9G97lggtDh7R/06dXUP/ZImRUI1iQknP9Cp5NpHMOmST8Co4WdRH96DnNIhK34CZLdcp5VDKE8=
  bucket: files.cct-ops.com
  acl: authenticated_read
  on:
    repo: alexshemesh/claptrap
    condition: $TRAVIS_GO_VERSION = 1.8.7
    tags: true
  local_dir: build
